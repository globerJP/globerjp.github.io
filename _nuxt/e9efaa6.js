(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{638:function(e,t,r){e.exports=r.p+"img/default_profile.18de71f.png"},648:function(e,t,r){e.exports=r.p+"img/glober-image-not-found.8168607.png"},653:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return c}));r(36),r(622);var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e){var r=e.seconds?new Date(1e3*e.seconds):e;if("HH:mm"===t)return"".concat(o(r.getHours(),2),":").concat(o(r.getMinutes(),2));if("DD MMMM YYYY"===t){var n={month:"long",year:"numeric",day:"numeric"};return"".concat(new Intl.DateTimeFormat("en-GB",n).format(r))}if("DD/MM/YY"===t){var c={month:"numeric",year:"numeric",day:"numeric"};return"".concat(new Intl.DateTimeFormat("en-GB",c).format(r))}if("DD MMMM, HH:mm"===t){var d={month:"long",day:"numeric"};return"".concat(new Intl.DateTimeFormat("en-GB",d).format(r),", ").concat(o(r.getHours(),2),":").concat(o(r.getMinutes(),2))}return r}},o=function(e,t){return String(e).padStart(t,"0")},c=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}},715:function(e,t,r){var content=r(864);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(23).default)("16a1d0aa",content,!0,{sourceMap:!1})},716:function(e,t,r){var content=r(866);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(23).default)("233e5d14",content,!0,{sourceMap:!1})},781:function(e,t,r){"use strict";r.r(t);var n=r(121),o=r(111),c=r(92),d=r(381),m=r(567),l=r(656),f=r(380),h=r(266),v=r(173),R=r(636),x=(r(37),r(18),r(17),r(16),r(24),r(15),r(25),r(14)),w=r(2),y=(r(58),r(34),r(66),r(59),r(93),r(8),r(83),r(36),r(659)),I=r.n(y),M=(r(660),r(623),r(79)),U=r(127),O=r.n(U);function k(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function j(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(t){Object(w.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var _={components:{Treeselect:I.a},props:["value","success","error","userName","learnerName"],data:function(){return{valid:!0,pageLoaded:!1,tempForm:{},firstName:"",lastName:"",email:"",instagramId:"",knows:"",learning:"",message:"",emailRules:[function(e){return!e||/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)||"E-mail must be valid"}],nameRules:[function(e){return!!e&&!!e.replace(/\s/g,"").length||"Name is required"},function(e){return!!e&&e.length<=40||"Name must be less than 40 characters"}],firstNameRules:[function(e){return!!e&&!!e.replace(/\s/g,"").length||"First Name is required"},function(e){return!!e&&e.length<=20||"Name must be less than 20 characters"}],lastNameRules:[function(e){return!!e||"Last Name is required"},function(e){return!!e&&e.length<=20||"Name must be less than 20 characters"}]}},computed:j({isMobileScreen:function(){return!(window.innerWidth>800)},user:function(){return this.$store.state.authUser}},Object(M.e)({account:function(e){return e.account.ACCOUNT}})),watch:{value:{handler:function(){this.fillForm()},immediate:!0,deep:!0}},methods:j(j(j({clearData:function(){this.$refs.form.reset()},makeString:function(e){if(!e)return"";if(1===e.length)return e[0];var t=e.slice(0,e.length-1),r=e[e.length-1];return t.join(", ")+" and "+r},fillForm:function(){var e,t;if(this.account){var r=(null===(e=this.account.knows)||void 0===e?void 0:e.join(", "))||"",n=(null===(t=this.account.learning)||void 0===t?void 0:t.join(", "))||"";this.tempForm={name:this.userName,firstName:this.account.firstName,lastName:this.account.lastName,email:this.account.email,instagramId:"",knows:this.account.knows,learning:this.account.learning,msgKnows:r,msgLearning:n,message:this.account.bio}}}},Object(M.b)({fetchAccount:"account/FETCH_ACCOUNT"})),Object(M.d)({setAccount:"account/SET_ACCOUNT"})),{},{validateSubmit:function(){var e=this;return Object(x.a)(regeneratorRuntime.mark((function t(){var r,n,data,o,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.$refs.form.validate(),n=Date.now().toString(),!r){t.next=27;break}return t.prev=3,data={fromEmail:e.tempForm.email,toEmail:e.value.email,message:e.tempForm.message,knows:e.tempForm.knows,learning:e.tempForm.learning,msgKnows:e.tempForm.msgKnows,msgLearning:e.tempForm.msgLearning,fromInstagramId:e.tempForm.instagramId,fromName:e.value.fromName,toName:e.value.toName,fromId:e.user.uid,toId:e.value.id,updatedAt:n,emailSentAt:null},t.next=7,e.$fire.firestore.collection("contacts").doc("".concat(e.user.uid).concat(e.value.id)).get();case 7:if(!(o=t.sent).exists){t.next=19;break}if(o=o.data(),data.createdAt=o.createdAt,!(c=parseInt(o.updatedAt))||!O()(c)){t.next=17;break}if(!((d=O()().diff(c,"minutes"))<30)){t.next=17;break}return $nuxt.$emit("error","One email has already been sent. Please wait ".concat(30-d," ").concat(30-d==1?"minute":"minutes"," before sending a new message.")),t.abrupt("return");case 17:t.next=20;break;case 19:data.createdAt=n;case 20:return t.next=22,e.$fire.firestore.collection("contacts").doc("".concat(e.user.uid).concat(e.value.id)).set(data).then((function(){e.$emit("createRoom",data.message),$nuxt.$emit("success","Successfully sent the email!!")}));case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(3),$nuxt.$emit("error","Could not send the email!!"+t.t0);case 27:case 28:case"end":return t.stop()}}),t,null,[[3,24]])})))()}})},D=(r(863),r(865),r(55)),component=Object(D.a)(_,(function(){var e=this,t=e._self._c;return t("div",[t(o.a,{staticStyle:{height:"fit-content"}},[t(c.d,{staticClass:"px-6"},[t("span",{staticStyle:{"word-break":"break-word"}},[e._v("\n        What would you like "+e._s(e.learnerName)+" to know about you?\n      ")])]),e._v(" "),t(l.a,{ref:"form",staticClass:"pa-4 pt-0",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(m.a,{staticStyle:{"max-width":"min(100%,800px)"}},[t(f.a,[t(d.a,{staticClass:"py-1",attrs:{cols:"12",md:"12",sm:"12"}},[t(v.a,{attrs:{rules:e.nameRules,label:"Name",required:""},model:{value:e.tempForm.name,callback:function(t){e.$set(e.tempForm,"name",t)},expression:"tempForm.name"}})],1),e._v(" "),t(d.a,{staticClass:"py-0",attrs:{cols:"12",md:"12",sm:"12"}},[t(R.a,{attrs:{rules:[function(e){return!!e||"Message is required"}],label:"Message",required:"",rows:"3"},model:{value:e.tempForm.message,callback:function(t){e.$set(e.tempForm,"message",t)},expression:"tempForm.message"}})],1),e._v(" "),t(d.a,{attrs:{cols:"12"}},[t(c.a,[t(h.a),e._v(" "),t(n.a,{attrs:{color:"primary",text:""},on:{click:function(t){return e.clearData()}}},[e._v("\n                Clear")]),e._v(" "),t(n.a,{attrs:{color:"primary",disabled:!e.valid},on:{click:e.validateSubmit}},[e._v("\n                Send\n              ")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"464574bf",null);t.default=component.exports},863:function(e,t,r){"use strict";r(715)},864:function(e,t,r){var n=r(22)(!1);n.push([e.i,"@media screen and (max-width:800px){.vue-treeselect__option-arrow-placeholder{display:none}}.v-autocomplete__content{max-height:46vh!important}",""]),e.exports=n},865:function(e,t,r){"use strict";r(716)},866:function(e,t,r){var n=r(22)(!1);n.push([e.i,".treeselect-title[data-v-464574bf]{left:5px;top:18px;right:auto;position:absolute;color:rgba(0,0,0,.6);transform:translateY(-18px) scale(.75)}@media screen and (min-width:960px){.treeselect-title[data-v-464574bf]{top:10px}}",""]),e.exports=n},867:function(e,t,r){var content=r(982);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(23).default)("f77a58f0",content,!0,{sourceMap:!1})},868:function(e,t,r){var content=r(984);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(23).default)("42dd523c",content,!0,{sourceMap:!1})},884:function(e,t,r){"use strict";r.r(t);r(17),r(24),r(25),r(70),r(34),r(78),r(85);var n=r(2),o=r(84),c=r(14),d=(r(58),r(8),r(15),r(36),r(59),r(112),r(40),r(45),r(18),r(16),r(93),r(76),r(213),r(37),r(57),r(585),r(586),r(587),r(588),r(589),r(590),r(591),r(592),r(593),r(594),r(595),r(596),r(597),r(598),r(599),r(600),r(601),r(653));function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){d=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(d)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function h(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var v={components:{ContactLearner:r(781).default},props:{value:{type:Object,required:!0},learnerAvatar:{type:String,required:!0},userAvatar:{type:String,required:!0},currentUserId:{type:String,required:!0},learnerUserId:{type:String,required:!0},userName:{type:String,default:""},learnerName:{type:String,default:""}},emits:["show-demo-options"],data:function(){return{createDialog:!1,inviteDialog:!1,removeDialog:!1,remainingUsersIdNameList:[],pageLoaded:!1,theme:"light",isDevice:!1,usersRef:null,roomsRef:null,messagesRef:null,filesRef:null,dbTimestamp:null,deleteDbField:null,roomsPerPage:15,rooms:[],roomId:"",startRooms:null,endRooms:null,roomsLoaded:!1,loadingRooms:!0,isRoom:!1,allUsers:[],allUsersDictionary:{},allUsersIdNameList:[],loadingLastMessageByRoom:0,roomsLoadedCount:!1,selectedRoom:null,messagesPerPage:20,messages:[],messagesLoaded:!1,roomMessage:"",startMessages:null,endMessages:null,roomsListeners:[],listeners:[],typingMessageCache:"",disableForm:!1,addNewRoom:null,addRoomUserIdList:[],inviteRoomId:null,invitedUserIdList:[],removeRoomId:null,removeUserId:"",removeUsers:[],roomActions:[{name:"inviteUser",title:"Invite User"},{name:"removeUser",title:"Remove User"},{name:"deleteRoom",title:"Delete Room"}],menuActions:[{name:"inviteUser",title:"Invite User"},{name:"removeUser",title:"Remove User"},{name:"deleteRoom",title:"Delete Room"}],styles:{container:{borderRadius:"5px"}},messageActions:[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!this.isAdmin}],templatesText:[{tag:"hello",text:"Hi there, nice you meet you."},{tag:"thanks",text:"Thank you so much."}]}},computed:{combinedIds:function(){var e=this.learnerUserId,t=this.currentUserId;return e>t?e+"-"+t:t+"-"+e},alteredRemoveUsers:function(){var e=this,t=[];return this.removeUsers.forEach((function(r){r._id!==e.currentUserId&&t.push({text:r.username,value:r._id})})),[].concat(t)},user:function(){return this.$store.state.authUser},loadedRooms:function(){return this.rooms.slice(0,this.roomsLoadedCount)},screenHeight:function(){return this.isDevice?window.innerHeight+"px":"calc(100vh - 130px)"}},mounted:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$fire.firestore,n=e.$fire.storage.ref(),e.usersRef=r.collection("chatUsers"),e.roomsRef=r.collection("chatRooms"),e.messagesRef=function(t){return e.roomsRef.doc(t).collection("chatMessages")},e.filesRef=n.child("chatFiles"),e.dbTimestamp=e.$fireModule.firestore.FieldValue.serverTimestamp(),e.deleteDbField=e.$fireModule.firestore.FieldValue.delete(),t.next=10,e.fetchRooms();case 10:e.pageLoaded=!0;case 11:case"end":return t.stop()}}),t)})))()},methods:{resetRooms:function(){this.loadingRooms=!0,this.loadingLastMessageByRoom=0,this.roomsLoadedCount=0,this.rooms=[],this.roomsLoaded=!0,this.startRooms=null,this.endRooms=null,this.roomsListeners.forEach((function(e){return e()})),this.roomsListeners=[],this.resetMessages()},resetMessages:function(){this.messages=[],this.messagesLoaded=!1,this.startMessages=null,this.endMessages=null,this.listeners.forEach((function(e){return e()})),this.listeners=[]},fetchRooms:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.resetRooms(),t.next=3,e.fetchMoreRooms();case 3:case"end":return t.stop()}}),t)})))()},fetchMoreRooms:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,c,d,m,l,f,v,R,x,w,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.endRooms||e.startRooms){t.next=2;break}return t.abrupt("return",e.roomsLoaded=!0);case 2:return n=null,c=e.roomsRef.where("users","==",[e.currentUserId,e.learnerUserId]),d=e.roomsRef.where("users","==",[e.learnerUserId,e.currentUserId]),t.next=7,c.get();case 7:return m=t.sent,t.next=10,d.get();case 10:if(l=t.sent,f=null,m.empty){t.next=17;break}n=c,f=m,t.next=23;break;case 17:if(l.empty){t.next=22;break}n=d,f=l,t.next=23;break;case 22:return t.abrupt("return");case 23:return e.startRooms&&(n=n.startAfter(e.startRooms)),v=f,e.roomsLoaded=v.empty||v.size<e.roomsPerPage,e.startRooms&&(e.endRooms=e.startRooms),e.startRooms=v.docs[v.docs.length-1],R=[],v.forEach((function(t){t.data().users.forEach((function(t){e.allUsers.find((function(e){return(null==e?void 0:e._id)===t}))||-1!==R.indexOf(t)||R.push(t)}))})),x=[],R.forEach((function(t){var r=e.usersRef.doc(t).get().then((function(e){return e.data()}));x.push(r)})),t.t0=[],t.t1=Object(o.a)(e.allUsers),t.t2=o.a,t.next=37,Promise.all(x);case 37:t.t3=t.sent,t.t4=(0,t.t2)(t.t3),e.allUsers=t.t0.concat.call(t.t0,t.t1,t.t4),w={},v.forEach((function(t){w[t.id]=h(h({},t.data()),{},{users:[]}),t.data().users.forEach((function(r){var n=e.allUsers.find((function(e){return(null==e?void 0:e._id)===r}));n&&w[t.id].users.push(n)}))})),y=[],Object.keys(w).forEach((function(t){var n=w[t];if(!n.eventId){var o=n.users.filter((function(t){return t._id!==e.currentUserId}));n.roomName=n.roomName||o.map((function(e){return e.username})).join(", ")||"Myself";var c=!n.eventId,d=c?n.roomAvatarUrl?n.roomAvatarUrl:r(638):n.roomAvatarUrl?n.roomAvatarUrl:r(648),m=n.users.filter((function(t){return(null==t?void 0:t._id)!==e.currentUserId}))[0];d=c&&m.avatar?m.avatar:d,y.push(h(h({},n),{},{roomId:t,avatar:d,index:n.lastUpdated.seconds,lastMessage:{content:"Room created",timestamp:e.formatTimestamp(new Date(n.lastUpdated.seconds),n.lastUpdated)}}))}})),e.rooms=e.rooms.concat(y),y.map((function(t){return e.listenLastMessage(t)})),e.rooms.length?e.isRoom=!0:(e.loadingRooms=!1,e.roomsLoadedCount=0,e.isRoom=!1),e.listenRooms(n);case 48:case"end":return t.stop()}}),t)})))()},listenLastMessage:function(e){var t=this,r=this.messagesRef(e.roomId).orderBy("timestamp","desc").limit(1).onSnapshot((function(r){r.forEach((function(r){var n=t.formatLastMessage(r.data()),c=t.rooms.findIndex((function(t){return e.roomId===t.roomId}));t.rooms[c].lastMessage=n,t.rooms=Object(o.a)(t.rooms)})),t.loadingLastMessageByRoom<t.rooms.length&&(t.loadingLastMessageByRoom++,t.loadingLastMessageByRoom===t.rooms.length&&(t.loadingRooms=!1,t.roomsLoadedCount=t.rooms.length))}));this.roomsListeners.push(r)},formatLastMessage:function(e){var t;if(e.timestamp){var content=e.content;if(null!==(t=e.files)&&void 0!==t&&t.length){var r=e.files[0];content="".concat(r.name,".").concat(r.extension||r.type)}return h(h({},e),{content:content,timestamp:this.formatTimestamp(new Date(1e3*e.timestamp.seconds),e.timestamp),distributed:!0,seen:e.sender_id===this.currentUserId?e.seen:null,new:!(e.sender_id===this.currentUserId||e.seen&&e.seen[this.currentUserId])})}},formatTimestamp:function(e,t){var r=Object(d.a)(e,new Date)?"HH:mm":"DD/MM/YY",n=Object(d.b)(t,r);return"HH:mm"===r?"Today, ".concat(n):n},fetchMessages:function(e){var t=this,r=e.room,n=e.options,o=void 0===n?{}:n;if(this.$emit("show-demo-options",!1),o.reset&&(this.resetMessages(),this.roomId=r.roomId),this.endMessages&&!this.startMessages)return this.messagesLoaded=!0;var c=this.messagesRef(r.roomId),d=c.orderBy("timestamp","desc").limit(this.messagesPerPage);this.startMessages&&(d=d.startAfter(this.startMessages)),this.selectedRoom=r.roomId,d.get().then((function(e){if(t.selectedRoom===r.roomId){(e.empty||e.docs.length<t.messagesPerPage)&&setTimeout((function(){return t.messagesLoaded=!0}),0),t.startMessages&&(t.endMessages=t.startMessages),t.startMessages=e.docs[e.docs.length-1];var n=c.orderBy("timestamp");t.startMessages&&(n=n.startAt(t.startMessages)),t.endMessages&&(n=n.endAt(t.endMessages)),o.reset&&(t.messages=[]),e.forEach((function(e){var n=t.formatMessage(r,e);t.messages.unshift(n)}));var d=n.onSnapshot((function(e){t.listenMessages(e,r)}));t.listeners.push(d)}}))},listenMessages:function(e,t){var r=this;e.forEach((function(e){var n=r.formatMessage(t,e),c=r.messages.findIndex((function(t){return t._id===e.id}));-1===c?r.messages=r.messages.concat([n]):(r.messages[c]=n,r.messages=Object(o.a)(r.messages)),r.markMessagesSeen(t,e)}))},markMessagesSeen:function(e,t){t.data().sender_id===this.currentUserId||t.data().seen&&t.data().seen[this.currentUserId]||this.messagesRef(e.roomId).doc(t.id).update(Object(n.a)({},"seen.".concat(this.currentUserId),new Date))},formatMessage:function(e,t){var r=e.users.find((function(e){return t.data().sender_id===e._id})),n=t.data().timestamp,o=h(h({},t.data()),{senderId:t.data().sender_id,_id:t.id,seconds:n.seconds,timestamp:Object(d.b)(n,"HH:mm"),date:Object(d.b)(n,"DD MMMM YYYY"),username:r?r.username:null,distributed:!0});return t.data().replyMessage&&(o.replyMessage=h(h({},t.data().replyMessage),{senderId:t.data().replyMessage.sender_id})),o},sendMessage:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var content,n,o,c,d,m,l,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return content=e.content,n=e.roomId,o=e.files,c=e.replyMessage,d={sender_id:t.currentUserId,content:content,timestamp:new Date},o&&(d.files=t.formattedFiles(o)),c&&(d.replyMessage={_id:c._id,content:c.content,sender_id:c.senderId},c.files&&(d.replyMessage.files=c.files)),r.next=6,t.messagesRef(n).add(d);case 6:if(m=r.sent,l=m.id,!o){r.next=16;break}f=0;case 10:if(!(f<o.length)){r.next=16;break}return r.next=13,t.uploadFile({file:o[f],messageId:l,roomId:n});case 13:f++,r.next=10;break;case 16:t.roomsRef.doc(n).update({lastUpdated:new Date});case 17:case"end":return r.stop()}}),r)})))()},editMessage:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c,d,m,l,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.messageId,o=e.newContent,c=e.roomId,d=e.files,(m={edited:new Date}).content=o,m.files=d?t.formattedFiles(d):t.deleteDbField,r.next=6,t.messagesRef(c).doc(n).update(m);case 6:if(!d){r.next=15;break}l=0;case 8:if(!(l<d.length)){r.next=15;break}if(null===(f=d[l])||void 0===f||!f.blob){r.next=12;break}return r.next=12,t.uploadFile({file:d[l],messageId:n,roomId:c});case 12:l++,r.next=8;break;case 15:case"end":return r.stop()}}),r)})))()},deleteMessage:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.message,o=e.roomId,window.confirm("Are you sure?")){r.next=4;break}return r.abrupt("return");case 4:return r.next=6,t.messagesRef(o).doc(n._id).update({deleted:new Date});case 6:(c=n.files)&&c.forEach((function(e){t.filesRef.child(t.currentUserId).child(n._id).child("".concat(e.name,".").concat(e.extension||e.type)).delete()}));case 8:case"end":return r.stop()}}),r)})))()},uploadFile:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,d,m,l,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.file,o=e.messageId,d=e.roomId,"svg"!==(m=n.extension||n.type)&&"pdf"!==m||(m=n.type),l=t.filesRef.child(t.currentUserId).child(o).child("".concat(n.name,".").concat(m)),(f=l.put(n.blob,{contentType:m})).on("state_changed",(function(e){var progress=Math.round(e.bytesTransferred/e.totalBytes*100);t.updateFileProgress(o,n.localUrl,progress)}),(function(e){}),Object(c.a)(regeneratorRuntime.mark((function e(){var r,c,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.snapshot.ref.getDownloadURL();case 2:return r=e.sent,e.next=5,t.messagesRef(d).doc(o).get();case 5:return c=e.sent,(m=c.data().files).forEach((function(e){e.url===n.localUrl&&(e.url=r)})),e.next=10,t.messagesRef(d).doc(o).update({files:m});case 10:case"end":return e.stop()}}),e)}))));case 6:case"end":return r.stop()}}),r)})))()},updateFileProgress:function(e,t,progress){var r=this.messages.find((function(t){return t._id===e}));r&&r.files&&(r.files.find((function(e){return e.url===t})).progress=progress,this.messages=Object(o.a)(this.messages))},formattedFiles:function(e){var t=[];return e.forEach((function(e){var r={name:e.name,size:e.size,type:e.type,extension:e.extension||e.type,url:e.url||e.localUrl};e.audio&&(r.audio=!0,r.duration=e.duration),t.push(r)})),t},openFile:function(e){var t=e.file;window.open(t.file.url,"_blank")},openUserTag:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c,d,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.user,t.rooms.forEach((function(e){if(2===e.users.length){var r=e.users[0]._id,c=e.users[1]._id;r!==n._id&&r!==t.currentUserId||c!==n._id&&c!==t.currentUserId||(o=e.roomId)}})),!o){r.next=4;break}return r.abrupt("return",t.roomId=o);case 4:return r.next=6,t.roomsRef.where("users","==",[t.currentUserId,n._id]).get();case 6:if((c=r.sent).empty){r.next=9;break}return r.abrupt("return",t.loadRoom(c));case 9:return r.next=11,t.roomsRef.where("users","==",[n._id,t.currentUserId]).get();case 11:if((d=r.sent).empty){r.next=14;break}return r.abrupt("return",t.loadRoom(d));case 14:return r.next=16,t.roomsRef.add({users:[n._id,t.currentUserId],lastUpdated:new Date});case 16:m=r.sent,t.roomId=m.id,t.fetchRooms();case 19:case"end":return r.stop()}}),r)})))()},loadRoom:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e.forEach(function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loadingRooms){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.roomsRef.doc(r.id).update({lastUpdated:new Date});case 4:t.roomId=r.id,t.fetchRooms();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),r)})))()},menuActionHandler:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.action,o=e.roomId,r.t0=n.name,r.next="inviteUser"===r.t0?4:"removeUser"===r.t0?7:"deleteRoom"===r.t0?10:13;break;case 4:return r.next=6,t.inviteUser(o);case 6:case 9:case 12:return r.abrupt("return",r.sent);case 7:return r.next=9,t.removeUser(o);case 10:return r.next=12,t.deleteRoom(o);case 13:case"end":return r.stop()}}),r)})))()},sendMessageReaction:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var o,c,d,m,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.reaction,c=e.remove,d=e.messageId,m=e.roomId,l=c?t.$fireModule.firestore.FieldValue.arrayRemove(t.currentUserId):t.$fireModule.firestore.FieldValue.arrayUnion(t.currentUserId),r.next=4,t.messagesRef(m).doc(d).update(Object(n.a)({},"reactions.".concat(o.unicode),l));case 4:case"end":return r.stop()}}),r)})))()},typingMessage:function(e){var t=e.message,r=e.roomId;if(r){if((null==t?void 0:t.length)>1)return this.typingMessageCache=t;if(1===(null==t?void 0:t.length)&&this.typingMessageCache)return this.typingMessageCache=t;this.typingMessageCache=t;var n=t?this.$fireModule.firestore.FieldValue.arrayUnion(this.currentUserId):this.$fireModule.firestore.FieldValue.arrayRemove(this.currentUserId);this.roomsRef.doc(r).update({typingUsers:n})}},listenRooms:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.onSnapshot((function(e){e.forEach((function(e){var r=t.rooms.find((function(t){return t.roomId===e.id}));r&&(r.typingUsers=e.data().typingUsers,r.index=e.data().lastUpdated.seconds)}))})),t.roomsListeners.push(n);case 2:case"end":return r.stop()}}),r)})))()},addRoom:function(){this.resetForms(),this.addNewRoom=!0,this.createDialog=!0},createRoom:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(n=[]).push(t.usersRef.doc(t.currentUserId).set({_id:t.currentUserId,username:t.userName,avatar:t.userAvatar})),n.push(t.usersRef.doc(t.learnerUserId).set({_id:t.learnerUserId,username:t.learnerName,avatar:t.learnerAvatar})),r.next=5,Promise.all(n);case 5:return r.next=7,t.roomsRef.add({users:[t.currentUserId,t.learnerUserId],lastUpdated:new Date});case 7:return o=r.sent,c={content:e||"Hello",roomId:o.id},r.next=11,t.sendMessage(c);case 11:t.roomId=o.id,t.fetchRooms();case 13:case"end":return r.stop()}}),r)})))()},inviteUser:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,c,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.resetForms(),t.inviteRoomId=e,r.next=4,t.roomsRef.doc(e).get().then((function(e){e.id;return e.data().users}));case 4:n=r.sent,c=new Set(n),d=t.allUsersIdNameList.filter((function(e){return!c.has(e.value)})),t.remainingUsersIdNameList=Object(o.a)(d),t.inviteDialog=!0;case 9:case"end":return r.stop()}}),r)})))()},addRoomUser:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.disableForm=!0,e.invitedUserIdList,r=[],e.invitedUserIdList.forEach((function(t){r.push(e.usersRef.doc(t).set({_id:t,username:e.allUsersDictionary[t]}))})),t.next=6,Promise.all(r);case 6:return n=[],e.invitedUserIdList.forEach((function(t){n.push(e.roomsRef.doc(e.inviteRoomId).update({users:e.$fireModule.firestore.FieldValue.arrayUnion(t)}))})),t.next=10,Promise.all(n);case 10:e.inviteRoomId=null,e.inviteDialog=!1,e.invitedUserIdList=[],e.remainingUsersIdNameList=[],e.fetchRooms();case 15:case"end":return t.stop()}}),t)})))()},removeUser:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.resetForms(),t.removeRoomId=e,t.removeUsers=t.rooms.find((function(t){return t.roomId===e})).users,t.removeDialog=!0;case 4:case"end":return r.stop()}}),r)})))()},deleteRoomUser:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.disableForm=!0,t.next=3,e.roomsRef.doc(e.removeRoomId).update({users:e.$fireModule.firestore.FieldValue.arrayRemove(e.removeUserId)});case 3:e.removeRoomId=null,e.removeUserId="",e.removeDialog=!1,e.fetchRooms();case 7:case"end":return t.stop()}}),t)})))()},deleteRoom:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.messagesRef(e),o=[],n.get().then((function(e){if(!e.empty){e.docs.map((function(e){return n.doc(e.id).delete()}));var r,c=m(e.docs);try{for(c.s();!(r=c.n()).done;){var d=r.value,data=(d.id,d.data());if(data.hasOwnProperty("files")){var l,f=m(data.files);try{for(f.s();!(l=f.n()).done;){var h=l.value;o.push(t.$fire.storage.refFromURL(h.url).delete())}}catch(e){f.e(e)}finally{f.f()}}}}catch(e){c.e(e)}finally{c.f()}}})),r.next=5,t.roomsRef.doc(e).delete();case 5:return r.next=7,Promise.all(o);case 7:t.fetchRooms();case 8:case"end":return r.stop()}}),r)})))()},resetForms:function(){this.disableForm=!1,this.addNewRoom=null,this.addRoomUserIdList=[],this.inviteRoomId=null,this.invitedUserIdList=[],this.remainingUsersIdNameList=[],this.removeRoomId=null,this.removeUserId=""}}},R=v,x=(r(981),r(983),r(55)),component=Object(x.a)(R,(function(){var e=this,t=e._self._c;return e.pageLoaded?t("div",{staticClass:"chatlearner-container",class:{"window-mobile":e.isDevice}},[e.isRoom?t("client-only",[t("vue-chat",{attrs:{height:e.screenHeight,"load-first-room":!0,"show-search":!1,"user-tags-enabled":!1,"show-emojis":!1,"show-add-room":!1,"show-reaction-emojis":!1,"username-options":{minUsers:1,currentUser:!1},theme:e.theme,styles:e.styles,"current-user-id":e.currentUserId,"room-id":e.roomId,rooms:e.loadedRooms,"loading-rooms":e.loadingRooms,messages:e.messages,"messages-loaded":e.messagesLoaded,"rooms-loaded":e.roomsLoaded,"room-message":e.roomMessage,"templates-text":e.templatesText,"message-actions":e.messageActions,"single-room":!0,"show-files":!1},on:{"fetch-more-rooms":e.fetchMoreRooms,"fetch-messages":e.fetchMessages,"send-message":e.sendMessage,"edit-message":e.editMessage,"delete-message":e.deleteMessage,"open-file":e.openFile,"send-message-reaction":e.sendMessageReaction,"typing-message":e.typingMessage,"toggle-rooms-list":function(t){return e.$emit("show-demo-options",t.opened)}}})],1):t("ContactLearner",{attrs:{value:e.value,userName:e.userName,learnerName:e.learnerName},on:{createRoom:e.createRoom}})],1):e._e()}),[],!1,null,"b259c3ca",null);t.default=component.exports;installComponents(component,{ContactLearner:r(781).default})},981:function(e,t,r){"use strict";r(867)},982:function(e,t,r){var n=r(22)(!1);n.push([e.i,"@media screen and (max-width:500px){.chatlearner-container .vac-room-footer{position:relative;width:100%;bottom:0}.chatlearner-container .vac-input{font-size:16px!important}}",""]),e.exports=n},983:function(e,t,r){"use strict";r(868)},984:function(e,t,r){var n=r(22)(!1);n.push([e.i,".window-container[data-v-b259c3ca]{width:100%}.window-mobile form[data-v-b259c3ca]{padding:0 10px 10px}form[data-v-b259c3ca]{padding-bottom:20px}input[data-v-b259c3ca]{padding:5px;width:140px;height:21px;border-radius:4px;border:1px solid #d2d6da;outline:none;font-size:14px;vertical-align:middle}input[data-v-b259c3ca]::-moz-placeholder{color:#9ca6af}input[data-v-b259c3ca]::placeholder{color:#9ca6af}button[data-v-b259c3ca]{background:#1976d2;color:#fff;outline:none;cursor:pointer;border-radius:4px;padding:8px 12px;margin-left:10px;border:none;font-size:14px;transition:.3s;vertical-align:middle}button[data-v-b259c3ca]:hover{opacity:.8}button[data-v-b259c3ca]:active{opacity:.6}button[data-v-b259c3ca]:disabled{cursor:auto;background:#c6c9cc;opacity:.6}.button-cancel[data-v-b259c3ca]{color:#a8aeb3;background:none;margin-left:5px}select[data-v-b259c3ca]{vertical-align:middle;height:33px;width:152px;font-size:13px;margin:0!important}",""]),e.exports=n}}]);